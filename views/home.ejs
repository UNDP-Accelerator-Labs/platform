<!DOCTYPE html>
<%
	// CREATE ALIASES
	const activity = locals.metadata.page.activity
	const publicpage = locals.metadata.page.public || activity === 'preview'
	const modules = locals.metadata.site.modules
	const metafields = locals.metadata.site.metafields
	const space = locals.metadata.page.space = 'published'
	const object = locals.metadata.page.object = 'pads'
	const languages = locals.metadata.site.languages
	const language = locals.metadata.page.language
	const pagedisplay = locals.metadata.page.display
	const pages = locals.metadata.page.count

	const logged = locals.metadata.user.uuid !== null

	let mapscale = locals.metadata.page.mscale
	// THIS IS FOR PUBLIC PINBOARDS: TO ENSURE THAT THE DEFINED MAP SCALE IS PRESERVED
	if (space === 'pinned' && (!locals.pinboard?.editable || activity === 'preview') && locals.pinboard?.display_map) {
		if (locals.pinboard?.display_fullscreen) mapscale = 'full-screen'
		else mapscale = 'contain'
	}
	
	const welcome_module = locals.metadata.site.welcome_module

	function simplifyNumber (num) {
		if (num > 1000) return `${Math.floor(num / 100) / 10}K+`
		else return num
	}
%>
<html lang='<%- language %>'>
<head>

<%- include ('./partials/head.ejs') %>

<script type='text/javascript' src='/js/browse/render.js'></script>
<script type='text/javascript' src='/js/home/main.js'></script>

</head>

<body>

<%- include('./browse/modules/data.ejs') %>

<%- include ('./partials/translations.ejs') %>

<%- include ('./partials/navigate/menu-languages.ejs') %>
<%- include ('./partials/modals.ejs') %>


<div class='main-content'>
<header>
	<div class='inner'>
		<%- include ('partials/navigate/sidebar.ejs') %>
	</div>
</header>
<div class='browse home'>
	<div class='panel public-page-header'>
		<div class='<%- welcome_module %> expand'>
			<% if (mapscale !== 'full-screen') { %>
				<% if (welcome_module === 'mosaic') { %>
					<%- include('./browse/modules/mosaic.ejs') %>
				<% } else if (welcome_module === 'carousel') { %>
					<%- include('./browse/modules/carousel.ejs') %>
				<% } %>
			<% } %>
			<button class='scroll-nav'>
				<label class='rotate'>&rsaquo;</label>
			</button>
		</div>
	</div>

	<div class='public-page-panel'>
		<div class='inner scroll-target'>
			<% if (locals.metadata.page.map && locals.stats?.total > 0) { %>
				<h1 class='site-title map-overlay'><%- (locals.metadata.site.title).replace(/\s+/g, '<br>') %></h1>
				<!-- <% if (locals.metadata.site.description?.[language]) { %><p class='lead'><%- locals.metadata.site.description[language] %></p><% } %> -->
				<!-- MAP -->
				<%- include ('./browse/modules/map') %>
			<% } else { %>
				<h1 class='site-title'><%- locals.metadata.site.title %></h1>
			<% } %>
			<div id='statistics'>
				<div class='stat-group'>
					<div class='statistic'>
						<h1><%- simplifyNumber(locals.stats?.total) %></h1>
						<p class="google-translate-attr"><%- vocabulary[object.slice(0, -1)]?.[language][locals.stats?.total !== 1 ? 'plural' : 'singular']?.capitalize() || object.capitalize() %></p>
					</div>
				</div>
				<div class='stat-group'>
					<% if (locals.stats?.contributors) { %>
						<div class='statistic'>
							<h2><%- simplifyNumber(locals.stats?.contributors) %></h2>
							<p class="google-translate-attr"><%- vocabulary['contributor']?.[language]['plural'].capitalize() %></p>
						</div>
					<% } %>
					<% if (locals.metadata.page.map && locals.stats?.total > 0) { %>
						<div class='statistic'>
							<h2><%- simplifyNumber(locals.locations || 0) %></h2>
							<p class="google-translate-attr"><%- vocabulary['distinct locations'][language]((locals.locations || 0) !== 1) %></p>
						</div>
					<% } %>
					<% locals.stats?.tags?.forEach(d => { %>
						<div class='statistic'>
							<h2><%- simplifyNumber(d.count) %></h2>
							<p class="google-translate-attr"><%- vocabulary[d.type.slice(0, -1).replace(/_/g, ' ')]?.[language]['plural'].capitalize() || d.type.capitalize() %></p>
						</div>
					<% }) %>
				</div>
			</div>
			<!-- <h3>ADD TAG CATEGORIES</h3> -->
			<nav class='enter'>
				<% if (!logged) { %>
					<a href='/<%- language %>/browse/pads/public'>
						<button type='button' class='highlight google-translate-attr'><%- vocabulary['browse publications'][language] %></button>
					</a>
					<a href='/login'><button class="google-translate-attr" type='button'><%- vocabulary['log in'][language] %></button></a>
					<!-- <button type='button' onclick='selectCountry()'>Get in touch</button> -->
					<!-- TO DO: TRANSLATE -->
				<% } else { %>
					<a href='/<%- language %>/browse/pads/published'>
						<button type='button' class='highlight google-translate-attr'><%- vocabulary['browse publications'][language] %></button>
					</a>
				<% } %>
			</nav>
		</div>
	</div>
	<div class='public-page-panel'>
		<div class='inner'>
			<p class='lead'>Grassroots innovations are home-grown solutions that have never been codified, applied elsewhere, nor taken to scale. These customized solutions are naturally frugal, grounded in a specific context, and might be more relevant, given their proximity to the problem. These solutions are often the result of innovation—people solving problems from the bottom up.</p>
		</div>
	</div>
	<div class='public-page-panel blue'>
		<div class='inner'>
			<blockquote>“In the drive for a fairer world, we have an—often-overlooked—asset: what 8 billion people around the world know about solving problems.”</blockquote>
			<p>Gina Lucarelli</p>
		</div>
	</div>
	<div class='public-page-panel'>
		<div class='inner'>
			<p class='lead'>On this platform you can find many early-stage, home-grown and often open-source grassroots solutions developed by people who are innovating in the margins to solve complex development challenges faced by their communities.</p>
		</div>
	</div>

	<div class='public-page-panel blue browse-countries'>
		<div class='inner'>
			<h3 class="google-translate-attr"><%- vocabulary['browse by country'][language] %></h3>
			<ul class='columns'>
			<% locals.countries.forEach(d => { %>
				<li>
					<% if (d.count > 0) { %>
						<a href='/<%- language %>/<%- d.iso3 %><% if (d.equivalents?.length) {%>?<% d.equivalents.forEach(c => { %>equivalents=<%- c %><% }) %><% } %>' target='_blank'><%- d.country %></a>
					<% } else { %>
						<%- d.country %>
					<% } %>
					<small class="google-translate-attr"><strong><%- d.count ?? 0 %></strong> <%- vocabulary['pad'][language][(d.count ?? 0) !== 1 ? 'plural' : 'singular'].toLowerCase() %></small>
				</li>
			<% }) %>
			</ul>
		</div>
	</div>
	<div class='public-page-panel'>
		<div class='inner'>
			<h3 class="google-translate-attr"><%- vocabulary['browse collections'][language] %></h3>
			<p class='description'>Collections are curated by our community members.</p>
			<!-- TO DO: TRANSLATE -->
			<ul class='columns'>
			<%# locals.pinboards.filter(d => logged ? true : d.count > 0).forEach(d => { %>
			<% locals.pinboards.filter(d => d.count > 0).forEach(d => { %>
				<li>
					<a href='/<%- language %>/browse/pads/pinned?pinboard=<%- d.id %>' target='_blank'><%- d.title %></a>
					<!-- TO DO: FIX THIS -->
					<small class="google-translate-attr"><strong><%- d.count %></strong> <%- vocabulary['pad'][language][d.count !== 1 ? 'plural' : 'singular'].toLowerCase() %></small>
					<small class='contributor google-translate-attr'><%- vocabulary['curation credit'][language](d.owner, d.ownername, 'contributors') %></small>
				</li>
			<% }) %>
			</ul>
		</div>
	</div>
</div>
<div class='sidebar xl xxl'></div>
</div>

<%- include ('./partials/footer.ejs') %>

<% if (!locals.metadata?.user?.uuid) { %>
	<script type='text/javascript' src='/js/home/explorations.js' defer></script>
<% } // logged out (!uuid) %>
</body>
</html>
